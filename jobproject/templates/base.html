<!DOCTYPE html>
<html>
  {% load static %}
  <head>
    <title>{{ template_data.title }}</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"crossorigin="anonymous">
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* Minimal flexbox layout to keep footer at the bottom */
      html, body {
        height: 100%;
      }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      main.site-content {
        flex: 1 0 auto; /* allow main content to grow and push footer down */
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary custom-lightblue">
      <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'home.index' %}">WorkFlow</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link {% if request.path == '/' %}active{% endif %}" {% if request.path == '/' %}aria-current="page"{% endif %} href="{% url 'home.index' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Account
                </a>
                <ul class="dropdown-menu">
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{% url 'accounts.signup' %}">Sign Up</a></li>
                  {% if user.is_authenticated %}
                    <li><a class="dropdown-item" href="{% url 'accounts.logout' %}">Logout ({{ user.username }})</a></li>
                    {% else %}
                    <li><a class="dropdown-item" href="{% url 'accounts.login' %}">Login</a></li>
                    {% endif %}
                    {% if user.is_seeker %}
                      <li><a class="dropdown-item" href="{% url 'my_applications' %}">My Applications</a></li>
                    {% endif %}
                </ul>
              </li>

          {% if request.user.is_authenticated and request.user.is_seeker %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Look for Jobs
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'jobs.index' %}">Available Jobs</a></li>
                
                {% if user.is_authenticated %}
                  <li><a class="dropdown-item" href="{% url 'recommended.index' %}">Recommendations</a></li>
                {% else %}
                  <li><a class="dropdown-item" href="{% url 'accounts.login' %}">Recommendations</a></li>
                {% endif %}       

                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'jobmap.index' %}">Job Map</a></li>
              </ul>
            </li>
          {% endif %}
              {% if request.user.is_authenticated and request.user.is_recruiter %}
                <a href="{% url 'post_job' %}" class="btn btn-primary" style="margin-left: 10px;">
                    Post Job
                </a>
              {% endif %}
             </ul>
            <form class="d-flex align-items-center" role="search" action="{% url 'jobs.filters' %}" method="get">
              <input class="form-control me-2" type="search" name="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success" type="submit">Search</button>
              {% if user.is_authenticated and user.is_recruiter %}
                <div class="ms-2 dropdown">
                  <button class="btn btn-outline-secondary dropdown-toggle position-relative" type="button" id="notifDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Notifications">
                    <i class="fas fa-bell"></i>
                    {% if user.unread_notifications_count %}
                      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ user.unread_notifications_count }}</span>
                    {% endif %}
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end p-2" aria-labelledby="notifDropdown" style="min-width:300px;">
                    {% with notifications=user.notifications.all|slice:":5" %}
                      {% if notifications %}
                        {% for n in notifications %}
                          <li>
                            <a href="{% url 'accounts.mark_notification_read' n.pk %}" class="dropdown-item small py-2{% if not n.is_read %} bg-light{% endif %}">
                              <div class="d-flex justify-content-between align-items-start">
                                <div class="me-2 text-truncate" style="max-width:200px;">
                                  {% if n.profile %}
                                    <strong>
                                      {% if n.profile.user.get_full_name %}
                                        {{ n.profile.user.get_full_name }}
                                      {% else %}
                                        {{ n.profile.user.username }}
                                      {% endif %}
                                    </strong>
                                    <div class="small text-muted">Matched for "{% if n.saved_search %}{{ n.saved_search.name }}{% else %}saved search{% endif %}"</div>
                                  {% else %}
                                    {{ n.message }}
                                  {% endif %}
                                </div>
                                <small class="text-muted">{{ n.created_at|timesince }} ago</small>
                              </div>
                            </a>
                          </li>
                          <li><hr class="dropdown-divider"></li>
                        {% endfor %}
                        <li><a class="dropdown-item text-center" href="{% url 'accounts.notifications' %}">View all notifications</a></li>
                      {% else %}
                        <li class="dropdown-item text-center text-muted">No notifications</li>
                      {% endif %}
                    {% endwith %}
                  </ul>
                </div>
              {% endif %}
              {% if user.is_authenticated %}
                <a class="btn btn-outline-primary ms-2 px-3" style="min-width:110px;" href="{% url 'profiles:edit' %}">My Profile</a>
              {% endif %}
            </form>
          </div>
        </div>
      </nav>
    <!-- Header -->
    <main class="site-content">
      {% if messages %}
        <div class="container mt-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      <div>
        {% block content %}
        {% endblock content %}
      </div>
    </main>
    <!-- Footer -->
      <section class="p-3 ms-footer">
        <div class="container">
          <div class="row mt-3 text-white align-items-start">
            <div class="col-12 col-md-6 col-lg-6 mb-4">
              <h5 class="mb-2">WorkFlow</h5>
              <hr />
              <p class="mb-0">
                Welcome to WorkFlow, your best friend in the job search!
                Here at WorkFlow, we understand the challenges of finding a 
                job that aligns with your skills and aspirations. Our mission is to
                simplify the job search process and connect you with recruiters and 
                different companies looking for similar skills and interests to you.
              </p>
            </div>
            <div class="col-6 col-md-3 col-lg-3 mb-4">
              <h6 class="mb-2">LINKS</h6>
              <hr />
              <ul class="list-unstyled mb-0">
                <li><a class="nav-link p-0 text-white" href="#">About</a></li>
                <li><a class="nav-link p-0 text-white" href="#">Jobs</a></li>
              </ul>
            </div>
            <div class="col-6 col-md-3 col-lg-3 mb-4">
              <h6 class="mb-2">CONTACT</h6>
              <hr />
              <p class="mb-1"><i class="fas fa-home me-2"></i>
                30332-0530 Atlanta, Georgia
              </p>
              <p class="mb-1"><i class="fas fa-envelope me-2"></i>
                info@workflow.com
              </p>
              <p class="mb-0"><i class="fas fa-phone me-2"></i>
                +81 04-4400-4400
              </p>
            </div>
          </div>
        </div>
      </section>
    <section class="p-3 ms-footer-bottom bg-dark">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-12 col-md-6 text-white text-start mb-2 mb-md-0">
            <span>Website Created By
              <a class="text-white" target="_blank">2340 Team 22</a>
            </span>
          </div>
          <div class="col-12 col-md-6 text-white text-md-end text-start">
            <span>2025</span>
          </div>
        </div>
      </div>
    </section>
    <!-- Footer -->
  </body>
</html>